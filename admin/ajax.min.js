/**
 * glFusion Tag Content Scan
 *
 * Iterates over all content
 *
 * LICENSE: This program is free software; you can redistribute it
 *  and/or modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * @category   glFusion CMS
 * @package    tag
 * @author     Mark R. Evans  mark AT glFusion DOT org
 * @copyright  2015-2016 - Mark R. Evans
 * @license    http://opensource.org/licenses/gpl-2.0.php - GNU Public License v2 or later
 * @since      File available since Release 1.6.3
 *
 */
var tagadminint=function(){var n={},t=null,a=null,i=null,o=0,e=0,l=null;n.update=function(){return o=0,i=site_admin_url+"/plugins/tag/scan_ajax.php",$("#tag_scanprocesor").show(),$("#rescanbutton").prop("disabled",!0),$("#rescanbutton").html(lang_scanning),r(),c(lang_scanning),$.ajax({type:"POST",dataType:"json",url:i,data:{mode:"pluginlist"},timeout:3e4}).done(function(n){var i=$.parseJSON(n.js);t=i.pluginlist,e=t.length,a=t.shift(),window.setTimeout(u,1e3)}),!1},n.init=function(){"log"==gl&&(l=$("#ajax_msg"),$t=$("#t"),l&&$("#rescanbutton").click(n.update))};var u=function(){a?(c(lang_scanning+" "+o+"/"+e+" - "+a),$.ajax({type:"POST",dataType:"json",url:i,data:{mode:"scanplugin",plugin:a},timeout:6e4}).done(function(n){var i=$.parseJSON(n.js);0!=i.errorCode&&console.log("TAGadmin: The content scan did not complete"),a=t.shift(),o++}).fail(function(n,t){console.log("timeout"===t?"TAGadmin: Timeout scanning plugin "+a:"TAGadmin: Error scanning plugin "+a),alert("TAGadmin: Error scanning plugin "+a),window.location.href=site_admin_url+"/plugins/tag/index.php"}).always(function(){var n=250;window.setTimeout(u,n)})):s()},s=function(){d(),c(lang_success),window.setTimeout(function(){$.ajax({type:"POST",dataType:"json",url:i,data:{mode:"complete"}}).done(function(){$("#rescanbutton").prop("disabled",!1),$("#rescanbutton").html(lang_scan),UIkit.modal.confirm(lang_success,function(){$(location).attr("href",site_admin_url+"/plugins/tag/index.php")},function(){},{labels:{Ok:lang_ok,Cancel:lang_cancel}})})},250)},c=function(n){l.html(n)},r=function(){$t.show()},d=function(){$t.hide()};return n}();$(function(){tagadminint.init()});